---
title: 面试系列 | Spring Cloud 核心知识总结
tags: Spring Cloud
categories: Spring Cloud
summary: Spring Cloud 微服务知识扫盲
abbrlink: 65045
date: 2022-08-25 10:09:36
---
面试系列 | Spring Cloud 核心知识总结
---

    下面是一张 Spring Cloud 核心组件关系图：
    从这张图中，其实我们是可以获取很多信息的，希望大家细细品尝。

![Spring Cloud 架构组件](https://gcore.jsdelivr.net/gh/lingzhexi/blogImage/img/2022/08/image-20220825165728905.png) 

<!--more-->

连环炮走起
-----

### 1、什么是 Spring Cloud ？

`Spring Cloud` 流应用程序启动器是基于 `Spring Boot` 的 `Spring` 集成应用程序，提供与外部系统的集成。

`Spring Cloud Task`，一个生命周期短暂的微服务框架，用于快速构建执行有限数据处理的应用程序。

### 2、什么是微服务？

​	微服务架构是一种【**架构模式**】或者说是一种【**架构风格**】，它提倡将单一应用程序划分为【**一组**】小的服务，每个服务运行在其独立的自己的进程中，服务之间【**相互协调、互相配合**】，为用户提供最终价值。

​	服务之间采用轻量级的通信机制互相沟通（通常是基于 `HTTP` 的 `RESTful API`）, 每个服务都围绕着【**具体的业务**】进行构建，并且能够被独立的构建在生产环境、类生产环境等。

​	另外，应避免统一的、集中式的服务管理机制，对具体的一个服务而言，应根据业务上下文，选择合适的语言、工具对其进行构建，可以有一个非常轻量级的集中式管理来协调这些服务，可以使用不同的语言来编写服务，也可以使用不同的数据存储。

**通俗地来讲：**

​	微服务就是一个【**独立**】的职责单一的服务应用程序。在 `IDEA` 工具里面就是用 `maven` 开发的一个个【**独立module**】，具体就是使用 `SpringBoot` 开发的一个小的模块，处理单一专业的业务逻辑，一个模块只做一个事情。

​	微服务强调的是服务大小，关注的是某一个点，具体解决某一个问题 / 落地对应的一个服务应用，可以看做是 idea 里面一个 module。

### 3、Spring Cloud 有什么优势

使用 Spring Boot 开发分布式微服务时，我们面临以下问题

*   **复杂性**：网络问题，延迟开销，带宽问题，安全问题
    
*   **服务发现**：服务发现工具管理群集中的流程和服务如何查找和互相交谈。它涉及一个服务目录，在该目录中注册服务，然后能够查找并连接到该目录中的服务。如`eureka、nacos`
    
*   **冗余**：分布式系统中的冗余问题。
    
*   **负载平衡**：负载平衡改善跨多个计算资源的工作负荷，诸如计算机，计算机集群，网络链路，中央处理单元，或磁盘驱动器的分布。
    
*   **性能**：问题 由于各种运营开销导致的性能问题。
    
*   **部署**：复杂性 Devops 技能的要求。

### 4、微服务之间如何独立通讯的?

- 同步通信：`dobbo` 通过 `RPC` 远程过程调用、`SpringCloud` 通过 `REST`  接口 `json` 调用等。

- 异步：MQ 消息队列，如：`RabbitMq`、`RocketMQ`、`ActiveM`、`Kafka`等消息队列。

### 5、 **什么是服务熔断？什么是服务降级？**

 - **熔断机制**：应对雪崩效应的一种【**微服务链路保护机制**】。
 - **服务降级**：当某个微服务【**不可用**】或者【**响应时间太长**】时，会进行服务降级，进而熔断该节点微服务的调用，快速返回 【“**错误**”】 的响应信息。
    - 当检测到该节点微服务调用响应正常后**恢复调用链路**。在 `Spring Cloud` 框架里熔断机制通过 `Hystrix` 实现。
    - `Hystrix` 会**监控**微服务间调用的状况，当失败的调用到一定【**阈值**】，缺省是 【**5 秒内调用 20 次**】，如果失败，就会启动熔断机制。
    - 服务降级，一般是从【**整体负荷考虑**】。就是当某个服务熔断之后，服务器将不再被调用，此时客户端可以自己准备一个【本地的 `fallback` 回调】，返回一个缺省值。这样做，虽然水平下降，但好歹可用，比直接挂掉强。
    - `Hystrix`相关注解 `@EnableHystrix`：开启熔断 `@HystrixCommand(fallbackMethod=”XXX”)`，声明一个失败回滚处理函数`XXX`，当被注解的方法执行超时（默认是 1000 毫秒），就会执行`fallback`函数，返回错误提示。

### 6、 请说说 Eureka 和 zookeeper 的区别？

- Zookeeper 保证了 CP，Eureka 保证了 AP。

> A：高可用
>
> C：一致性
>
> P：分区容错性

1. 当向注册中心查询服务列表时，我们可以容忍注册中心返回的是几分钟以前的信息，但不能容忍直接 down 掉不可用。也就是说，服务注册功能对高可用性要求比较高，但 zk 会出现这样一种情况，当 master 节点因为网络故障与其他节点失去联系时，剩余节点会重新选 leader。问题在于，选取 leader 时间过长，30 ~ 120s，且选取期间 zk 集群都不可用，这样就会导致选取期间注册服务瘫痪。在云部署的环境下，因网络问题使得 zk 集群失去 master 节点是较大概率会发生的事，虽然服务能够恢复，但是漫长的选取时间导致的注册长期不可用是不能容忍的。

2.Eureka 保证了可用性，Eureka 各个节点是平等的，几个节点挂掉不会影响正常节点的工作，剩余的节点仍然可以提供注册和查询服务。而 Eureka 的客户端向某个 Eureka 注册或发现时发生连接失败，则会自动切换到其他节点，只要有一台 Eureka 还在，就能保证注册服务可用，只是查到的信息可能不是最新的。除此之外，Eureka 还有自我保护机制，如果在 15 分钟内超过 85% 的节点没有正常的心跳，那么 Eureka 就认为客户端与注册中心发生了网络故障，此时会出现以下几种情况：

①、Eureka 不在从注册列表中移除因为长时间没有收到心跳而应该过期的服务。

②、Eureka 仍然能够接受新服务的注册和查询请求，但是不会被同步到其他节点上（即保证当前节点仍然可用）

③、当网络稳定时，当前实例新的注册信息会被同步到其他节点。

因此，Eureka 可以很好地应对因网络故障导致部分节点失去联系的情况，而不会像 Zookeeper 那样使整个微服务瘫痪

### 7、SpringBoot 和 SpringCloud 的区别？

SpringBoot 专注于快速方便得开发单个个体微服务。

SpringCloud 是关注全局的微服务协调整理治理框架，它将 SpringBoot 开发的一个个单体微服务整合并管理起来，

为各个微服务之间提供，配置管理、服务发现、断路器、路由、微代理、事件总线、全局锁、决策竞选、分布式会话等等集成服务

SpringBoot 可以离开 SpringCloud 独立使用开发项目， 但是 SpringCloud 离不开 SpringBoot ，属于依赖的关系.

SpringBoot 专注于快速、方便得开发单个微服务个体，SpringCloud 关注全局的服务治理框架。

### 8、负载平衡的意义什么？

在计算中，负载平衡可以改善跨计算机，计算机集群，网络链接，中央处理单元或磁盘驱动器等多种计算资源的工作负载分布。负载平衡旨在优化资源使用，最大化吞吐量，最小化响应时间并避免任何单一资源 的过载。使用多个组件进行负载平衡而不是单个组件可能会通过冗余来提高可靠性和可用性。负载平衡通常涉及专用软件或硬件，例如多层交换机或域名系统服务器进程。

### 9、什么是 Hystrix？它如何实现容错？

Hystrix 是一个延迟和容错库，旨在隔离远程系统，服务和第三方库的访问点，当出现故障是不可避免的故障时，停止级联故障并在复杂的分布式系统中实现弹性。

通常对于使用微服务架构开发的系统，涉及到许多微服务。这些微服务彼此协作。

思考一下微服务：

![](https://gcore.jsdelivr.net/gh/lingzhexi/blogImage/img/2022/08hystrix)

假设如果上图中的微服务 9 失败了，那么使用传统方法我们将传播一个异常。但这仍然会导致整个系统崩溃。

随着微服务数量的增加，这个问题变得更加复杂。微服务的数量可以高达 1000. 这是 hystrix 出现的地方 我们将使用 Hystrix 在这种情况下的 Fallback 方法功能。我们有两个服务 employee-consumer 使用由 employee-consumer 公开的服务。

简化图如下所示

![](https://gcore.jsdelivr.net/gh/lingzhexi/blogImage/img/2022/08hystrix2)

现在假设由于某种原因，employee-producer 公开的服务会抛出异常。我们在这种情况下使用 Hystrix 定义了一个回退方法。这种后备方法应该具有与公开服务相同的返回类型。如果暴露服务中出现异常，则回退方法将返回一些值。

### 10、什么是 Hystrix 断路器？我们需要它吗？

由于某些原因，employee-consumer 公开服务会引发异常。在这种情况下使用 Hystrix 我们定义了一个回退方法。如果在公开服务中发生异常，则回退方法返回一些默认值。

![](https://gcore.jsdelivr.net/gh/lingzhexi/blogImage/img/2022/08hystrix3)

  

如果 firstPage method() 中的异常继续发生，则 Hystrix 电路将中断，并且员工使用者将一起跳过 firtsPage 方法，并直接调用回退方法。断路器的目的是给第一页方法或第一页方法可能调用的其他方法留出时间，并导致异常恢复。可能发生的情况是，在负载较小的情况下，导致异常的问题有更好的恢复机会 。

![](https://gcore.jsdelivr.net/gh/lingzhexi/blogImage/img/2022/08hystrix4)

  

### 11、说说 RPC 的实现原理

首先需要有处理网络连接通讯的模块，负责连接建立、管理和消息的传输。其次需要有编 解码的模块，因为网络通讯都是传输的字节码，需要将我们使用的对象序列化和反序列 化。剩下的就是客户端和服务器端的部分，服务器端暴露要开放的服务接口，客户调用服 务接口的一个代理实现，这个代理实现负责收集数据、编码并传输给服务器然后等待结果 返回。

### 12，eureka 自我保护机制是什么?

当 Eureka Server 节点在短时间内丢失了过多实例的连接时（比如网络故障或频繁启动关闭客户端）节点会进入自我保护模式，保护注册信息，不再删除注册数据，故障恢复时，自动退出自我保护模式。

### 13，什么是 Ribbon？

ribbon 是一个负载均衡客户端，可以很好地控制 htt 和 tcp 的一些行为。`feign默认集成了ribbon`。

### 14，什么是 Netflix Feign？它的优点是什么？

Feign 是受到 Retrofit，JAXRS-2.0 和 WebSocket 启发的 java 客户端联编程序。

Feign 的第一个目标是将约束分母的复杂性统一到 http apis，而不考虑其稳定性。

特点：

*   Feign 采用的是基于接口的注解
    
*   Feign 整合了 ribbon，具有负载均衡的能力
    
*   整合了 Hystrix，具有熔断的能力
    

使用方式

*   添加 pom 依赖。
    
*   启动类添加`@EnableFeignClients`
    
*   定义一个接口`@FeignClient(name=“xxx”)`指定调用哪个服务
    

### 15， Ribbon 和 Feign 的区别？

1.Ribbon 都是调用其他服务的，但方式不同。2. 启动类注解不同，Ribbon 是 @RibbonClient feign 的是 @EnableFeignClients 3. 服务指定的位置不同，Ribbon 是在 @RibbonClient 注解上声明，Feign 则是在定义抽象方法的接口中使用 @FeignClient 声明。4. 调用方式不同，Ribbon 需要自己构建 http 请求，模拟 http 请求。

### 16、Spring Cloud 的核心组件有哪些？

*   Eureka：服务注册于发现。
    
*   Feign：基于动态代理机制，根据注解和选择的机器，拼接请求 url 地址，发起请求。
    
*   Ribbon：实现负载均衡，从一个服务的多台机器中选择一台。
    
*   Hystrix：提供线程池，不同的服务走不同的线程池，实现了不同服务调用的隔离，避免了服务雪崩的问题。
    
*   Zuul：网关管理，由 Zuul 网关转发请求给对应的服务。
    

### 17、说说 Spring Boot 和 Spring Cloud 的关系

Spring Boot 是 Spring 推出用于解决传统框架配置文件冗余, 装配组件繁杂的基于 Maven 的解决方案, 旨在快速搭建单个微服务 而 Spring Cloud 专注于解决各个微服务之间的协调与配置, 服务之间的通信, 熔断, 负载均衡等 技术维度并相同, 并且 Spring Cloud 是依赖于 Spring Boot 的, 而 Spring Boot 并不是依赖与 Spring Cloud, 甚至还可以和 Dubbo 进行优秀的整合开发

总结

*   SpringBoot 专注于快速方便的开发单个个体的微服务
    
*   SpringCloud 是关注全局的微服务协调整理治理框架, 整合并管理各个微服务, 为各个微服务之间提供, 配置管理, 服务发现, 断路器, 路由, 事件总线等集成服务
    
*   Spring Boot 不依赖于 Spring Cloud，Spring Cloud 依赖于 Spring Boot, 属于依赖关系
    
*   Spring Boot 专注于快速, 方便的开发单个的微服务个体, Spring Cloud 关注全局的服务治理框架
    

### 18、说说微服务之间是如何独立通讯的？

#### 远程过程调用（Remote Procedure Invocation）

也就是我们常说的服务的注册与发现，直接通过远程过程调用来访问别的 service。

**优点**：简单，常见, 因为没有中间件代理，系统更简单

**缺点**：只支持请求 / 响应的模式，不支持别的，比如通知、请求 / 异步响应、发布 / 订阅、发布 / 异步响应，降低了可用性，因为客户端和服务端在请求过程中必须都是可用的。

#### 消息

使用异步消息来做服务间通信。服务间通过消息管道来交换消息，从而通信。

**优点**：把客户端和服务端解耦，更松耦合，提高可用性，因为消息中间件缓存了消息，直到消费者可以消费，       支持很多通信机制比如通知、请求 / 异步响应、发布 / 订阅、发布 / 异步响应。

**缺点**：消息中间件有额外的复杂。

### 19、Spring Cloud 如何实现服务的注册?

服务发布时，指定对应的服务名，将服务注册到 注册中心 (`Eureka 、Zookeeper)`。

注册中心加`@EnableEurekaServer`，服务用`@EnableDiscoveryClient`，然后用 ribbon 或 feign 进行服务直接的调用发现。

此题偏向于向实战，就看你是不是背面试题的，没有实战的人是不知道的。

### 20、什么是服务熔断？

在复杂的分布式系统中, 微服务之间的相互调用, 有可能出现各种各样的原因导致服务的阻塞, 在高并发场景下, 服务的阻塞意味着线程的阻塞, 导致当前线程不可用, 服务器的线程全部阻塞, 导致服务器崩溃, 由于服务之间的调用关系是同步的, 会对整个微服务系统造成服务雪崩

为了解决某个微服务的调用响应时间过长或者不可用进而占用越来越多的系统资源引起雪崩效应就需要进行服务熔断和服务降级处理。

所谓的服务熔断指的是某个服务故障或异常一起类似显示世界中的 “保险丝 " 当某个异常条件被触发就直接熔断整个服务，而不是一直等到此服务超时。

服务熔断就是相当于我们电闸的保险丝, 一旦发生服务雪崩的, 就会熔断整个服务, 通过维护一个自己的线程池, 当线程达到阈值的时候就启动服务降级, 如果其他请求继续访问就直接返回 fallback 的默认值

### 21、了解 Eureka 自我保护机制吗？

当 Eureka Server 节点在短时间内丢失了过多实例的连接时（比如网络故障或频繁启动关闭客户端）节点会进入自我保护模式，保护注册信息，不再删除注册数据，故障恢复时，自动退出自我保护模式。

### 22、熟悉 Spring Cloud Bus 吗?

spring cloud bus 将分布式的节点用轻量的消息代理连接起来，它可以用于广播配置文件的更改或者服务直接的通讯，也可用于监控。如果修改了配置文件，发送一次请求，所有的客户端便会重新读取配置文件。

### 23、Spring Cloud 断路器有什么作用?

当一个服务调用另一个服务由于网络原因或自身原因出现问题，调用者就会等待被调用者的响应，当更多的服务请求到这些资源导致更多的请求等待，发生连锁效应（雪崩效应）。一段时间内 达到一定的次数无法调用 并且多次监测没有恢复的迹象，这时候断路器完全打开 那么下次请求就不会请求到该服务。

半开：短时间内 有恢复迹象 断路器会将部分请求发给该服务，正常调用时 断路器关闭。关闭：当服务一直处于正常状态 能正常调用。

### 24、了解 Spring Cloud Config 吗?

在分布式系统中，由于服务数量巨多，为了方便服务配置文件统一管理，实时更新，所以需要分布式配置中心组件。在 Spring Cloud 中，有分布式配置中心组件`Spring Cloud Config`，它支持配置服务放在配置服务的内存中（即本地），也支持放在远程 Git 仓库中。

在`Spring Cloud Config` 组件中，分两个角色，一是 config server，二是 config client。

使用方式：

*   添加 pom 依赖
    
*   配置文件添加相关配置
    
*   启动类添加注解 @EnableConfigServer
    

### 25、说说你对 Spring Cloud Gateway 的理解

Spring Cloud Gateway 是 Spring Cloud 官方推出的第二代网关框架，取代 Zuul 网关。网关作为流量的，在微服务系统中有着非常作用，网关常见的功能有路由转发、权限校验、限流控制等作用。

使用了一个 RouteLocatorBuilder 的 bean 去创建路由，除了创建路由 RouteLocatorBuilder 可以让你添加各种 predicates 和 filters，predicates 断言的意思，顾名思义就是根据具体的请求的规则，由具体的 route 去处理，filters 是各种过滤器，用来对请求做各种判断和修改。

参考；http://1pgqu.cn/M0NZo

总结
--

Spring Cloud 目前相当的火热，也差不多是 java 开发者必备技能之一了。面试的时候被问，那也是正常不过了，很多人可能用来很久，但是没有去了解过原理，面试照样挂掉。背面试题，在很大层面上还是很有用的。但从长远角度来说，希望大家更深层次去学习、去实践。只有自己真的掌握，那才叫 NB。
